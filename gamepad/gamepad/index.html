<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Control PacMan</title>
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <link href="icon.png" rel="apple-touch-icon" /> 

        <style>
            #c2canvasdiv {
                width:320px;
                height:320px;
                margin:0 auto;
                float:none;
            }

            #c2canvas {
                position: absolute;
                bottom: 0;
            }
        </style>
    </head>
    <body>
        <div id="wrapper">
            <div style="text-align:center;">
                Other links and info here
            </div>
            <div id="c2canvasdiv">
                <!-- The canvas the project will render to.  If you change its ID, don't forget to change the
                ID the runtime looks for in the jQuery events above (ready() and cr_sizeCanvas()). -->
                <canvas id="c2canvas" width="320" height="320" bottom="0">
                    <!-- This text is displayed if the visitor's browser does not support HTML5.
                    You can change it, but it is a good idea to link to a description of a browser
                    and provide some links to download some popular HTML5-compatible browsers. -->
                    <h1>Your browser does not appear to support HTML5.  Try upgrading your browser to the latest version.  <a href="http://www.whatbrowser.org">What is a browser?</a>
                    <br/><br/><a href="http://www.microsoft.com/windows/internet-explorer/default.aspx">Microsoft Internet Explorer</a><br/>
                    <a href="http://www.mozilla.com/firefox/">Mozilla Firefox</a><br/>
                    <a href="http://www.google.com/chrome/">Google Chrome</a><br/>
                    <a href="http://www.apple.com/safari/download/">Apple Safari</a><br/>
                    <a href="http://www.google.com/chromeframe">Google Chrome Frame for Internet Explorer</a><br/></h1>
                </canvas>            
            </div>
        </div>

        <script language="JavaScript" type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"></script>
        <script language="JavaScript" type="text/javascript" src="../assets/js/libs/gamecontroller.js"></script>
        <script src="../socket.io/socket.io.js"></script>
        <script>

            var webSocket;

            var server_ip = "192.168.1.7:8888";

            $(window).on("load",function(){

                function webSocketSend (cmd) {
                    webSocket.emit("gamepad", cmd);
                };

                function initControl() {

                    var options = {
                        touchRadius: 100,
                        left:{
                            position:{
                                left: '50%',
                                bottom: '50%'
                            },
                            dpad: { 
                                up: {
                                    opacity: 1,
                                    stroke: 20,
                                    width: '20%', 
                                    height: '30%' ,
                                    touchStart: function(){
                                        // Send an up event
                                        webSocketSend({"stop":"previous"});
                                        webSocketSend({"go":"up"});
                                    },
                                    touchEnd: function(){
                                        webSocketSend({"stop":"up"});
                                    }
                                }, 
                                down: {
                                    stroke: 20,
                                    width: '20%', 
                                    height: '30%',
                                    touchStart: function(){
                                        // Send an up event
                                        webSocketSend({"stop":"previous"});
                                        webSocketSend({"go":"down"});
                                    },
                                    touchEnd: function(){
                                        webSocketSend({"stop":"down"});
                                    }   
                                }, 
                                left: {
                                    stroke: 20,
                                    width: '30%', 
                                    height: '20%',
                                    touchStart: function(){
                                        // Send an up event
                                        webSocketSend({"stop":"previous"});
                                        webSocketSend({"go":"left"});
                                    },
                                    touchEnd: function(){
                                        webSocketSend({"stop":"left"});
                                    }                                    
                                 }, 
                                right: {
                                    stroke: 20,
                                    width: '30%', 
                                    height: '20%',
                                    touchStart: function(){
                                        // Send an up event
                                        webSocketSend({"stop":"previous"});
                                        webSocketSend({"go":"right"});
                                    },
                                    touchEnd: function(){
                                        webSocketSend({"stop":"right"});
                                    }
                                } 
                            }
                        },
                        right:{
                            type: 'buttons',
                            buttons:[false,false,false,false]
                        }
                    };
                    GameController.init( options );

                    // Small adjustemet for iPhone:
                    //document.ontouchmove = function(e) {e.preventDefault()}; // disable scrolling
                    //setTimeout(function() { window.scrollTo(0, 1) }, 100); // hide the address bar;
                };

                function webSocketInitialize() {
                    
                    webSocket = io.connect(server_ip);

                    webSocket.emit('gamepad', 'gamepad connected');

                    if(typeof webSocket !== "undefined")
                    {
                        initControl();
                    }

                };

                webSocketInitialize();

            });

        </script>
    </body>
</html>